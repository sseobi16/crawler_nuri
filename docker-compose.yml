services:
  # 1. 과거 데이터 수집 
  history-loader:
    build: .
    image: nuri-crawler
    init: true
    container_name: nuri-history
    volumes:
      - ./data:/app/data
    command: ["python", "main.py", "--mode", "history", "--start", "${HISTORY_START}", "--end", "${HISTORY_END}"]
    environment:
      - TZ=${TZ}

  # 2. 인터벌 감시
  monitor-interval:
    build: .
    image: nuri-crawler
    init: true
    container_name: nuri-interval
    volumes:
      - ./data:/app/data
    command: ["python", "main.py","--mode", "interval", "--interval", "${INTERVAL_SEC}"]
    restart: unless-stopped
    environment:
      - TZ=${TZ}

  # 3. 정시 스케줄 감시
  monitor-cron:
    build: .
    image: nuri-crawler
    init: true
    container_name: nuri-cron
    volumes:
      - ./data:/app/data
    command: ["python", "main.py","--mode", "cron", "--hour", "${CRON_HOUR}"]
    restart: unless-stopped
    environment:
      - TZ=${TZ}

# 4. 실시간 대시보드
  dashboard:
    build: .
    image: nuri-crawler 
    init: true
    container_name: nuri-dashboard
    volumes:
      - ./data:/app/data  
    command: ["streamlit", "run", "dashboard.py", "--server.port", "8501", "--server.address", "0.0.0.0"]
    ports:
      - "8501:8501"
    restart: unless-stopped
    environment:
      - TZ=${TZ}